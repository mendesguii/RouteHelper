<div class="box">
            <div class="is-pulled-right is-size-7" title="AIRAC {{ airac.cycle or 'unknown' }} ({{ airac.name or 'X-Plane' }})">
                    <span>AIRAC: <strong>{{ airac.cycle or 'unknown' }}</strong></span>
                    {% if airac.cycle and airac.is_current %}
                    <span style="color:#48c774;" aria-label="Up to date" title="Up to date">‚úî</span>
                    {% elif airac.cycle %}
                    <span style="color:#f14668;" aria-label="Out of date" title="Out of date">‚úñ</span>
                    {% else %}
                        <span style="color:#ffdd57;" aria-label="Missing" title="cycle.json not found">?</span>
                {% endif %}
        </div>
    <h2 class="subtitle">Loadsheet <span>üßæ</span></h2>
    <div class="columns">
        <div class="column">Total Traffic Load (kg): <strong>{{ ttl or 'N/A' }}</strong></div>
        <div class="column">Take Off Fuel (kg): <strong>{{ tof or 'N/A' }}</strong></div>
        <div class="column">SI Block Time: <strong>{{ blk or 'N/A' }}</strong></div>
        <div class="column">Endurance: <strong>{{ endurance or 'N/A' }}</strong></div>
    </div>
    <details>
        <summary>Raw loadsheet text</summary>
        <pre>{{ loadsheet }}</pre>
    </details>
    <hr>
        <h2 class="subtitle">Route <span>üó∫Ô∏è</span></h2>
        {% if 'Error:' in route_text and 'cycle.json' in route_text %}
        <article class="message is-danger">
            <div class="message-body">
                {{ route_text }}. Please ensure a valid cycle.json is present under your DATA_PATH.
            </div>
        </article>
        {% endif %}
    <textarea id="route-text" name="items" class="textarea" rows="3">{{ route_text }}</textarea>
    <div class="field" style="margin-top: .5rem;">
        <form hx-post="/route_map" hx-include="#route-text" hx-target="#route-map-container" hx-swap="innerHTML" hx-indicator="#map-loading" class="control">
            <input type="hidden" name="origin" value="{{ origin }}">
            <input type="hidden" name="dest" value="{{ dest }}">
            <button class="button is-small is-link" type="submit">Show Route on Map</button>
            <span id="map-loading" class="htmx-indicator" style="margin-left: .5rem;">Loading map‚Ä¶</span>
        </form>
    </div>
    <div id="route-map-container"></div>
    <div class="columns">
        <div class="column">
            {% include 'partials/sid_block.html' %}
        </div>
        <div class="column">
            {% include 'partials/star_block.html' %}
        </div>
    </div>
    <hr>
    <h2 class="subtitle">METAR <span>‚òÅÔ∏è</span></h2>
    <div class="columns">
        <div class="column">
            {% set icao = origin %}
            {% set metar = metar_origin %}
            {% include 'partials/metar_block.html' %}
        </div>
        <div class="column">
            {% set icao = dest %}
            {% set metar = metar_dest %}
            {% include 'partials/metar_block.html' %}
        </div>
    </div>
    <hr>
    <h2 class="subtitle">VATSIM - ICAO FPL <span>üìù</span></h2>
    <textarea class="textarea" readonly rows="4">{{ icao_fpl }}</textarea>
    <div class="field is-grouped is-grouped-centered">
        <div class="control">
            <a href="/" class="button is-light">Back</a>
        </div>
    </div>
</div>
<script>
// Apply theme from localStorage to result page as well
(function(){
    var root = document.documentElement;
    var theme = localStorage.getItem('theme') || 'auto';
    var isDark = theme === 'dark' || (theme === 'auto' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
    if (isDark) root.classList.add('dark'); else root.classList.remove('dark');
})();
</script>
