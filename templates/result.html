<div class="box">
    <!-- Header: ORIGIN ✈ DEST (no box) with tag design -->
    <div style="margin-bottom:1rem;">
        <div class="is-flex is-justify-content-center is-align-items-center" style="gap:1rem; flex-wrap:wrap;">
            <span class="tag is-light is-large" title="Origin"
                  style="color:#a2f5bf; border:1px solid rgba(162,245,191,0.6); background:rgba(162,245,191,0.10);">
                {{ origin }}
            </span>
            <span class="tag is-medium" aria-hidden="true"
                  style="background:transparent; border:none; color:#cfd8dc; font-size:1.25rem;">✈</span>
            <span class="tag is-light is-large" title="Destination"
                  style="color:#ffcc80; border:1px solid rgba(255,204,128,0.6); background:rgba(255,204,128,0.10);">
                {{ dest }}
            </span>
        </div>
    </div>
        
    
    <h1 class="title is-4">Loadsheet <span>🧾</span></h1>
    <!-- Summary bar: 5 items evenly distributed -->
    <div class="columns is-mobile is-multiline" style="text-align:center;">
        <div class="column is-one-fifth">
            <div class="box" style="padding:.75rem;">
                <div class="is-size-7 has-text-grey">Total Traffic Load (kg)</div>
                <div class="is-size-5"><strong>{{ ttl or 'N/A' }}</strong></div>
            </div>
        </div>
        <div class="column is-one-fifth">
            <div class="box" style="padding:.75rem;">
                <div class="is-size-7 has-text-grey">Takeoff Fuel (kg)</div>
                <div class="is-size-5"><strong>{{ tof or 'N/A' }}</strong></div>
            </div>
        </div>
        <div class="column is-one-fifth">
            <div class="box" style="padding:.75rem;">
                <div class="is-size-7 has-text-grey">SI Block</div>
                <div class="is-size-5"><strong>{{ blk or 'N/A' }}</strong></div>
            </div>
        </div>
        <div class="column is-one-fifth">
            <div class="box" style="padding:.75rem;">
                <div class="is-size-7 has-text-grey">Endurance</div>
                <div class="is-size-5"><strong>{{ endurance or 'N/A' }}</strong></div>
            </div>
        </div>
        <div class="column is-one-fifth">
            <div class="box" style="padding:.75rem;">
                <div class="is-size-7 has-text-grey">TC</div>
                <div class="is-size-5"><strong>{{ tc or 'N/A' }}</strong></div>
            </div>
        </div>
    </div>
    <details>
        <summary>Raw loadsheet text</summary>
        <pre>{{ loadsheet }}</pre>
    </details>
    <hr>
        <!-- Callsign + UTC Off-block + Eligible FLs Row (equal height) -->
            <div class="columns is-variable is-3 equal-cols">
                <div class="column is-full-mobile is-one-third-tablet is-one-third-desktop">
                <div class="box callsign-card" aria-labelledby="callsign-title">
                    <div class="ascii-bg" aria-hidden="true">
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
            ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
            ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
            ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
            ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
                    </div>
                    <div class="content-wrap">
                                    <div class="is-flex is-align-items-center is-justify-content-space-between" style="gap:.5rem;">
                                        <h2 id="callsign-title" class="title is-6" style="margin:0;">Callsign</h2>
                                    </div>
                        <div class="field" style="margin-top:.5rem;">
                            <div class="control has-icons-left">
                                <input id="callsign-input" class="input" type="text" placeholder="e.g. RYR7321" maxlength="8" autocomplete="off" aria-label="Callsign (updates the FPL)">
                                <span class="icon is-left" aria-hidden="true">✈</span>
                            </div>
                        </div>
                        <div class="is-size-7 has-text-grey">Examples:</div>
                        <div aria-label="Example callsigns" style="margin-top:.25rem;">
                            <span class="callsign-example" data-cs="RYR7321" title="Ryanair 7321" style="cursor:pointer; text-decoration:underline;">RYR7321</span>
                            <span> · </span>
                            <span class="callsign-example" data-cs="BAW123" title="British Airways 123" style="cursor:pointer; text-decoration:underline;">BAW123</span>
                            <span> · </span>
                            <span class="callsign-example" data-cs="DAL432" title="Delta 432" style="cursor:pointer; text-decoration:underline;">DAL432</span>
                            <span> · </span>
                            <span class="callsign-example" data-cs="AFR570" title="Air France 570" style="cursor:pointer; text-decoration:underline;">AFR570</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column is-full-mobile is-one-third-tablet is-one-third-desktop">
                <div class="box callsign-card utc-box" aria-labelledby="utc-offblock-title">
                    <div class="ascii-bg" aria-hidden="true">
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
            ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
                    </div>
                    <div class="is-flex is-justify-content-space-between is-align-items-center" style="margin:.25rem 0 .25rem;">
                        <h2 id="utc-offblock-title" class="title is-6" style="margin:0;">UTC Off‑block</h2>
                        <div style="min-width:160px; flex:0 0 auto; margin-left:auto; text-align:left;">
                            <label id="dep-time-label" class="label is-size-6" for="dep-time-input" style="margin:0;">Departure (HHMM)</label>
                        </div>
                    </div>
                    <div class="is-flex is-align-items-center is-justify-content-space-between" style="gap:.75rem; flex-wrap:nowrap; margin:0;">
                        <div style="flex:1 1 auto;">
                            <div class="is-size-3" id="utc-clock" aria-live="polite">--:--Z</div>
                        </div>
                        <div style="min-width:160px; flex:0 0 auto; margin-left:auto;">
                            <div class="field has-addons" style="margin-bottom:0;">
                                <div class="control" style="width:112px;">
                                    <input id="dep-time-input" class="input is-medium" type="text" inputmode="numeric" pattern="\\d{4}" maxlength="4" placeholder="HHMM" aria-labelledby="dep-time-label" aria-label="Departure UTC time in HHMM">
                                </div>
                                <div class="control">
                                    <button id="use-now-btn" class="button is-link is-medium" type="button" title="Use current UTC time" aria-label="Use current UTC time">⏱️</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column is-full-mobile is-one-third-tablet is-one-third-desktop">
                <div class="box callsign-card alt-fl" style="margin-top:.25rem;">
                    <div class="ascii-bg" aria-hidden="true">
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
            ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈ ✈ ✈  F P L  ✈ ✈
            F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈ F P L ✈
                    </div>
                    <strong>Eligible flight levels:</strong>
                    {% if eligible_fls and eligible_fls|length > 0 %}
                    <div class="tags" style="margin-top:.25rem;">
                        {% for fl in eligible_fls %}
                        <span class="tag is-clickable" title="Use {{ fl }}">{{ fl }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    <span class="is-size-7 has-text-grey">No eligible levels — TC direction unknown.</span>
                    {% endif %}
                    <div class="is-size-7 has-text-grey">{{ altitude_rule }}{% if route_direction %} (direction: {{ route_direction }}){% endif %}</div>
                </div>
            </div>
        </div>
    <hr>
        <h1 class="title is-4">Route <span>🗺️</span></h1>
        {% if 'Error:' in route_text and 'cycle.json' in route_text %}
        <article class="message is-danger">
            <div class="message-body">
                {{ route_text }}. Please ensure a valid cycle.json is present under your DATA_PATH.
            </div>
        </article>
        {% endif %}
    <textarea id="route-text" name="items" class="textarea" rows="3">{{ route_text }}</textarea>
    <div class="field" style="margin-top: .5rem;">
        <form hx-post="/route_map" hx-include="#route-text" hx-target="#route-map-container" hx-swap="innerHTML" hx-indicator="#map-loading" class="control">
            <input type="hidden" name="origin" value="{{ origin }}">
            <input type="hidden" name="dest" value="{{ dest }}">
            <button class="button is-small is-link" type="submit">Show Route on Map</button>
            <span id="map-loading" class="htmx-indicator" style="margin-left: .5rem;">Loading map…</span>
        </form>
    </div>
    <div id="route-map-container"></div>
    <hr>
    <div class="columns">
        <div class="column">
            {% include 'partials/sid_block.html' %}
        </div>
        <div class="column">
            {% include 'partials/star_block.html' %}
        </div>
    </div>
    <hr>

    <div class="columns">
        <div class="column">
            <h2 class="title is-5">METARs <span>☁️</span></h2>
            <div class="columns is-variable is-3">
                <div class="column">
                    {% set icao = origin %}
                    {% set metar = metar_origin %}
                    {% set airport_kind = 'origin' %}
                    {% include 'partials/metar_block.html' %}
                </div>
                <div class="column">
                    {% set icao = dest %}
                    {% set metar = metar_dest %}
                    {% set airport_kind = 'dest' %}
                    {% include 'partials/metar_block.html' %}
                </div>
            </div>
        </div>
    </div>

    <hr>

    <h1 class="title is-4">ICAO FPL <span>📝</span></h1>
    <div class="field">
        <div class="control">
            <textarea id="icao-fpl-text" class="textarea" rows="10" readonly>{{ icao_fpl }}</textarea>
        </div>
    </div>
    <div class="field is-grouped is-grouped-centered">
        <div class="control">
            <a id="vatsim-file-link" class="button is-primary" href="#" target="_blank" rel="noopener">File flight plan on VATSIM</a>
        </div>
    </div>
