<div class="box">
    <!-- Header: ORIGIN ‚úà DEST inside its own box with tag design -->
    <div class="box" style="margin-bottom:1rem;">
        <div class="is-flex is-justify-content-center is-align-items-center" style="gap:1rem; flex-wrap:wrap;">
            <span class="tag is-light is-large" title="Origin"
                  style="color:#a2f5bf; border:1px solid rgba(162,245,191,0.6); background:rgba(162,245,191,0.10);">
                {{ origin }}
            </span>
            <span class="tag is-medium" aria-hidden="true"
                  style="background:transparent; border:none; color:#cfd8dc; font-size:1.25rem;">‚úà</span>
            <span class="tag is-light is-large" title="Destination"
                  style="color:#ffcc80; border:1px solid rgba(255,204,128,0.6); background:rgba(255,204,128,0.10);">
                {{ dest }}
            </span>
        </div>
    </div>
    
    <h2 class="subtitle">Loadsheet <span>üßæ</span></h2>
    <!-- Summary bar: 5 items evenly distributed -->
    <div class="columns is-mobile is-multiline" style="text-align:center;">
        <div class="column is-one-fifth">
            <div class="is-size-7 has-text-grey">Total Traffic Load (kg)</div>
            <div class="is-size-5"><strong>{{ ttl or 'N/A' }}</strong></div>
        </div>
        <div class="column is-one-fifth">
            <div class="is-size-7 has-text-grey">Takeoff Fuel (kg)</div>
            <div class="is-size-5"><strong>{{ tof or 'N/A' }}</strong></div>
        </div>
        <div class="column is-one-fifth">
            <div class="is-size-7 has-text-grey">SI Block</div>
            <div class="is-size-5"><strong>{{ blk or 'N/A' }}</strong></div>
        </div>
        <div class="column is-one-fifth">
            <div class="is-size-7 has-text-grey">Endurance</div>
            <div class="is-size-5"><strong>{{ endurance or 'N/A' }}</strong></div>
        </div>
        <div class="column is-one-fifth">
            <div class="is-size-7 has-text-grey">TC</div>
            <div class="is-size-5"><strong>{{ tc or 'N/A' }}</strong></div>
        </div>
    </div>
    <details>
        <summary>Raw loadsheet text</summary>
        <pre>{{ loadsheet }}</pre>
    </details>
    <hr>
        <h2 class="subtitle">Route <span>üó∫Ô∏è</span></h2>
        {% if 'Error:' in route_text and 'cycle.json' in route_text %}
        <article class="message is-danger">
            <div class="message-body">
                {{ route_text }}. Please ensure a valid cycle.json is present under your DATA_PATH.
            </div>
        </article>
        {% endif %}
    <textarea id="route-text" name="items" class="textarea" rows="3">{{ route_text }}</textarea>
    <div class="field" style="margin-top: .5rem;">
        <form hx-post="/route_map" hx-include="#route-text" hx-target="#route-map-container" hx-swap="innerHTML" hx-indicator="#map-loading" class="control">
            <input type="hidden" name="origin" value="{{ origin }}">
            <input type="hidden" name="dest" value="{{ dest }}">
            <button class="button is-small is-link" type="submit">Show Route on Map</button>
            <span id="map-loading" class="htmx-indicator" style="margin-left: .5rem;">Loading map‚Ä¶</span>
        </form>
    </div>
    <div id="route-map-container"></div>
    <div class="columns">
        <div class="column">
            {% include 'partials/sid_block.html' %}
        </div>
        <div class="column">
            {% include 'partials/star_block.html' %}
        </div>
    </div>
    <hr>
    <h2 class="subtitle">METAR <span>‚òÅÔ∏è</span></h2>
    <div class="columns">
        <div class="column">
            {% set icao = origin %}
            {% set metar = metar_origin %}
            {% include 'partials/metar_block.html' %}
        </div>
        <div class="column">
            {% set icao = dest %}
            {% set metar = metar_dest %}
            {% include 'partials/metar_block.html' %}
        </div>
    </div>
    <hr>
    <h2 class="subtitle">VATSIM - ICAO FPL <span>üìù</span></h2>
    <textarea class="textarea" readonly rows="4">{{ icao_fpl }}</textarea>
    <div class="field is-grouped is-grouped-centered">
        <div class="control">
            <a href="/" class="button is-light">Back</a>
        </div>
    </div>
</div>
<script>
// Apply theme from localStorage to result page as well
(function(){
    var root = document.documentElement;
    var theme = localStorage.getItem('theme') || 'auto';
    var isDark = theme === 'dark' || (theme === 'auto' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
    if (isDark) root.classList.add('dark'); else root.classList.remove('dark');
})();
</script>
